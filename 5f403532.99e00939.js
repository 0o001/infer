(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{147:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return u}));var r=t(1),a=t(9),i=(t(0),t(177)),o={id:"steps-for-ci",title:"Recommended flow for CI"},c={id:"steps-for-ci",title:"Recommended flow for CI",description:"The recommended flow for CI integration is to determine the modified files, and",source:"@site/docs/01-steps-for-ci.md",permalink:"/docs/steps-for-ci",sidebar:"docs",previous:{title:"Analyzing apps or projects",permalink:"/docs/analyzing-apps-or-projects"},next:{title:"Infer : AI",permalink:"/docs/checkers"}},l=[{value:"Differential Workflow",id:"differential-workflow",children:[]},{value:"Example: Android Gradle",id:"example-android-gradle",children:[]}],s={rightToc:l},d="wrapper";function u(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)(d,Object(r.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The recommended flow for CI integration is to determine the modified files, and\nrun the analysis in reactive mode starting from those files. If you would like\nto run more than one analyzer, it is more efficient to separate the capture\nphase, so that the result can be used by all the analyzers."),Object(i.b)("h3",{id:"differential-workflow"},"Differential Workflow"),Object(i.b)("p",null,"Here's how to run infer on two versions of a project and compare the results in\ngeneral."),Object(i.b)("p",null,"Assume the project uses git, ",Object(i.b)("inlineCode",{parentName:"p"},"feature")," is the feature branch (the code change\nyou want to analyze), ",Object(i.b)("inlineCode",{parentName:"p"},"master")," is the master branch, and ",Object(i.b)("inlineCode",{parentName:"p"},"make")," builds the\nproject."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"# go to feature branch if not there already\ngit checkout feature\n# get list of changed files\ngit diff --name-only origin/feature..origin/master > index.txt\n## first run: feature branch\n# run infer on the feature branch\ninfer capture -- make -j 4  # assuming a machine with 4 cores\ninfer analyze --changed-files-index index.txt\n# store the infer report\ncp infer-out/report.json report-feature.json\n## second run: master branch\ngit checkout master\n# run capture in reactive mode so that previously-captured source files are kept if they are up-to-date\ninfer capture --reactive -- make -j 4\ninfer analyze --reactive --changed-files-index index.txt\n# compare reports\ninfer reportdiff --report-current report-feature.json --report-previous infer-out/report.json\n")),Object(i.b)("p",null,'At the end of this process, "infer-out/differential/" contains three files,\nwhich follow the same format as normal infer JSON reports:'),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"introduced.json contains the issues found in the feature branch but not in\nmaster;"),Object(i.b)("li",{parentName:"ul"},"fixed.json contains the issues found in master but not in the feature branch;"),Object(i.b)("li",{parentName:"ul"},"preexisting.json contains the issues found in both branches.")),Object(i.b)("h3",{id:"example-android-gradle"},"Example: Android Gradle"),Object(i.b)("p",null,"The following CI script runs the ",Object(i.b)("inlineCode",{parentName:"p"},"infer")," and ",Object(i.b)("inlineCode",{parentName:"p"},"eradicate")," analyzers. Assume again\nthat ",Object(i.b)("inlineCode",{parentName:"p"},"feature")," is the feature branch, and ",Object(i.b)("inlineCode",{parentName:"p"},"master")," is the master branch."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"git diff --name-only origin/feature..origin/master > index.txt\ninfer capture -- ./gradlew --offline assembleDebug\ninfer analyze --fail-on-issue --eradicate --changed-files-index ./index.txt\n")),Object(i.b)("p",null,"Notice that"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"We use git to find the changed files ",Object(i.b)("inlineCode",{parentName:"li"},"git diff --name-only")),Object(i.b)("li",{parentName:"ul"},"We run capture only once, and the output is kept for the subsequent analyses"),Object(i.b)("li",{parentName:"ul"},"We run the eradicate analysis alongside the default analyses: ",Object(i.b)("inlineCode",{parentName:"li"},"--eradicate")),Object(i.b)("li",{parentName:"ul"},"We analyze only the changed files ",Object(i.b)("inlineCode",{parentName:"li"},"--changed-files-index ./index.txt"))))}u.isMDXComponent=!0},177:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(0),a=t.n(r),i=a.a.createContext({}),o=function(e){var n=a.a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},c=function(e){var n=o(e.components);return a.a.createElement(i.Provider,{value:n},e.children)};var l="mdxType",s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},d=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,l=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),d=o(t),u=r,f=d[c+"."+u]||d[u]||s[u]||i;return t?a.a.createElement(f,Object.assign({},{ref:n},l,{components:t})):a.a.createElement(f,Object.assign({},{ref:n},l))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c[l]="string"==typeof e?e:r,o[1]=c;for(var u=2;u<i;u++)o[u]=t[u];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);