<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Infer Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Infer Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Infer" href="/opensearch.xml"><title data-react-helmet="true">AST Language (AL) | Infer</title><meta data-react-helmet="true" property="og:url" content="https://fbinfer.com/docs/1.0.0/checker-linters"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="1.0.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-1.0.0"><meta data-react-helmet="true" property="og:title" content="AST Language (AL) | Infer"><meta data-react-helmet="true" name="description" content="Declarative linting framework over the Clang AST."><meta data-react-helmet="true" property="og:description" content="Declarative linting framework over the Clang AST."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fbinfer.com/docs/1.0.0/checker-linters"><link data-react-helmet="true" rel="alternate" href="https://fbinfer.com/docs/1.0.0/checker-linters" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fbinfer.com/docs/1.0.0/checker-linters" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.46ed01ba.css">
<link rel="preload" href="/assets/js/styles.7a3bfc13.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.f45cfbc3.js" as="script">
<link rel="preload" href="/assets/js/main.4397eb74.js" as="script">
<link rel="preload" href="/assets/js/1.b5bf5a34.js" as="script">
<link rel="preload" href="/assets/js/2.87dfd38b.js" as="script">
<link rel="preload" href="/assets/js/3.529b6fba.js" as="script">
<link rel="preload" href="/assets/js/1be78505.c4007472.js" as="script">
<link rel="preload" href="/assets/js/183.7a16840f.js" as="script">
<link rel="preload" href="/assets/js/62e81aa6.e2500d24.js" as="script">
<link rel="preload" href="/assets/js/17896441.1b2449d5.js" as="script">
<link rel="preload" href="/assets/js/e2e89445.5243bdc8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Infer Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Infer Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Infer</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/docs/support">Support</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://twitter.com/fbinfer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><a href="https://www.facebook.com/inferstaticanalyzer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Facebook</a><a href="https://github.com/facebook/infer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Infer Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Infer Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Infer</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/support">Support</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://twitter.com/fbinfer" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li><li class="menu__list-item"><a href="https://www.facebook.com/inferstaticanalyzer" target="_blank" rel="noopener noreferrer" class="menu__link">Facebook</a></li><li class="menu__list-item"><a href="https://github.com/facebook/infer" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/getting-started">Getting started with Infer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/hello-world">Hello, World!</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/infer-workflow">Infer workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/analyzing-apps-or-projects">Analyzing apps or projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/steps-for-ci">Recommended flow for CI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/advanced-features">Advanced usage</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Infer Manuals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer">infer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-analyze">infer analyze</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-capture">infer capture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-compile">infer compile</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-debug">infer debug</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-explore">infer explore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-help">infer help</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-report">infer report</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-reportdiff">infer reportdiff</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/man-infer-run">infer run</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Analyses and Issue Types</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/all-issue-types">List of all issue types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-annotation-reachability">Annotation Reachability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-biabduction">Biabduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-bufferoverrun">Buffer Overrun Analysis (InferBO)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-config-checks-between-markers">Config Checks between Markers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-cost">Cost: Runtime Complexity Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-eradicate">Eradicate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-fragment-retains-view">Fragment Retains View</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-immutable-cast">Immutable Cast</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-impurity">Impurity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-inefficient-keyset-iterator">Inefficient keySet Iterator</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/1.0.0/checker-linters">AST Language (AL)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-litho-required-props">Litho &quot;Required Props&quot;</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-liveness">Liveness</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-loop-hoisting">Loop Hoisting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-printf-args">`printf()` Argument Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-pulse">Pulse</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-purity">Purity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-quandary">Quandary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-racerd">RacerD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-resource-leak-lab">Resource Leak Lab Exercise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-siof">Static Initialization Order Fiasco</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-self-in-block">Self in Block</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-starvation">Starvation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-topl-biabd">TOPL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-topl-pulse">TOPL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/checker-uninit">Uninitialized Value</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Foundations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/about-Infer">About Infer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/separation-logic-and-bi-abduction">Separation logic and bi-abduction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/absint-framework">Building checkers with the Infer.AI framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/internal-API">Infer Internal OCaml Modules API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/1.0.0/versions">Documentation Versions</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Infer <strong>1.0.0</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/checker-linters">latest version</a></strong> (1.1.0).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: 1.0.0</span></div><header><h1 class="docTitle_3a4h">AST Language (AL)</h1></header><div class="markdown"><p>Declarative linting framework over the Clang AST.</p><p><strong>***DEPRECATED***</strong> On end-of-life support, may be removed in the future.</p><p>Activate with <code>--linters</code>.</p><p>Supported languages:</p><ul><li>C/C++/ObjC: Yes</li><li>Java: No</li></ul><p>For C/C++ and Objective-C languages, we provide a linters framework. These are
checks about the syntax of the program; it could be about a property, or about
code inside one method, or that a class or method have certain properties. We
provide <a href="#list-of-issue-types">a few checks by default</a> and we have developed a domain
specific language (DSL) to make it easier to write checks.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="al-a-declarative-language-for-writing-linters-in-infer"></a>AL: A declarative language for writing linters in Infer<a class="hash-link" href="#al-a-declarative-language-for-writing-linters-in-infer" title="Direct link to heading">#</a></h2><p>One of the major advantage of Infer when compared with other static analyzers is
the fact it performs sophisticated inter-procedural/inter-file analysis. That
is, Infer can detect bugs which involve tracking values through many procedure
calls and the procedures may live in different files. These may be very subtle
bugs and designing static analyses to do that is quite involved and normally
requires deep static analysis expertise.</p><p>However, there are many important software bugs that are confined in the code of
a single procedure (called intra-procedural). To detect these bugs simpler
analyses may suffice which do not require deep technical expertise in static
analysis. Often these bugs can be expressed by referring to the syntax of the
program, or the types of certain expressions. We have defined a new language to
easily design checkers which identify these kind of bugs. The language is called
AL (AST Language) and its main feature is the ability to reason about the
Abstract Syntax Tree of a program in a concise declarative way. AL&#x27;s checkers
are interpreted by Infer to analyze programs. Thus, to detect new kind of bugs
in Infer one can just write a check in AL. We will see in more detail later,
that for writing AL formulas we also need predicates: simple functions that
check a property of the AST. Predicates are written in OCaml inside Infer, thus
it requires a bit of OCaml knowledge and getting familiar with the OCaml data
structure for the clang AST.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getting-the-clang-ast"></a>Getting the clang AST<a class="hash-link" href="#getting-the-clang-ast" title="Direct link to heading">#</a></h2><p>When you write a linter that traverses the AST of some programs to check some
property, you probably need to understand what the AST looks like. You can get
the AST of programs using clang directly, or using Infer.</p><p>If you have a clang command <code>clang &lt;clang arguments&gt; File.m</code> then you can get
the AST with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">clang </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">clang arguments</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> -Xclang -ast-dump -fsyntax-only File.m</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can also get the AST using Infer. One advantage of this is that you don&#x27;t
need to know the speicifc clang command, just the general build command.
Moreover, what you get here is exactly the form of the AST that Infer has as
input.</p><p>For this you need to install an OCaml package <code>biniou</code> with
<code>opam install biniou</code>. See <a href="https://opam.ocaml.org/" target="_blank" rel="noopener noreferrer">the opam website</a> for
instructions on how to install opam.</p><p>Then, the AST can be created by Infer in debug mode. Call Infer with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">infer --debug -- </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">build command</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will, among other things, generate a file <code>/path/to/File.m.ast.sh</code> for
every file <code>/path/to/File.m</code> that is being analyzed. Run this script with
<code>bash File.m.ast.sh</code> and a file <code>/path/to/File.m.ast.bdump</code> will be generated,
that contains the AST of the program in <code>bdump</code> format (similar to json). If you
get an error about <code>bdump</code> not being found you may need to run
<code>eval $(opam env)</code> to get the <code>bdump</code> executable (provided by the biniou opam
package) into your <code>PATH</code>.</p><p>For general info on the clang AST, you can check out
<a href="http://clang.llvm.org/docs/IntroductionToTheClangAST.html" target="_blank" rel="noopener noreferrer">clang&#x27;s website</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-al-to-write-linters"></a>Using AL to write linters<a class="hash-link" href="#using-al-to-write-linters" title="Direct link to heading">#</a></h2><p>Let&#x27;s start with an example. Suppose we want to write the following
Objective-C&#x27;s linter:</p><p><em>&quot;a property containing the word &#x27;delegate&#x27;, but not containing the word &#x27;queue&#x27;
should not be declared strong&quot;</em>.</p><p>We can write this property in the following way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER STRONG_DELEGATE_WARNING </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    LET name_contains_delegate </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        declaration_has_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">REGEXP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[dD]elegate&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    LET name_does_not_contain_queue </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NOT declaration_has_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">REGEXP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[qQ]ueue&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET report_when </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           name_contains_delegate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           AND name_does_not_contain_queue</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           AND is_strong_property</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCPropertyDecl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Property or ivar %decl_name% declared strong&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET suggestion </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;In general delegates should be declared weak or assign&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET severity </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;WARNING&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The linter definition starts with the keyword <code>DEFINE-CHECKER</code> followed by the
checker&#x27;s name. The first <code>LET</code> clause defines the <em>formula variable</em>
<code>name_contains_delegate</code> using the predicate <code>declaration_has_name</code> which return
true/false depending whether the property&#x27;s name contains a word in the language
of the regular expression <code>[dD]elegate</code>. In general a predicate is a simple
atomic formula evaluated on an AST node. The list of available predicates is in
the module
<a href="https://github.com/facebook/infer/blob/master/infer/src/clang/cPredicates.mli" target="_blank" rel="noopener noreferrer"><code>cPredicates.mli</code></a>
(this list is continuously growing and if you need a new predicate you can add
it in ocaml). Formula variables can be used to simplify other definitions. The
<code>SET report_when</code> is mandatory and defines a formula that, when evaluates to
true, will tell Infer to report an error. In the case above, the formula is
saying that we should report when visiting an <code>ObjCPropertyDecl</code> (that is the
AST node declaring a property in Objective-C) where it holds that: the name
contains &quot;delegate/Delegate&quot; (<code>name_contains_delegate</code>) and the name doesn&#x27;t
contain &quot;queue/Queue&quot; (<code>name_does_not_contain_queue</code>) and the node is defining a
&quot;strong&quot; property (<code>is_strong_property()</code>).</p><p>The <code>SET message</code> clause defines the error message that will be displayed to the
user. Notice that the message can include placeholders like <code>%decl_name%</code>.
Placeholders are evaluated by Infer and substituted by their current value when
the error message is reported. In this case the name of the declaration. The
<code>SET suggestion</code> clause define an optional hint to give to programmer on how to
fix the problem.</p><p>The general structure of a checker is the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER id_of_the_checker </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     LET formula </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">formula definition</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     LET ….</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET report_when </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">formula definition</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">optional name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">error message to show the user</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET suggestion </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">optional suggestion to the user</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET doc_url </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">optional URL to documentation of the issue</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET severity </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> INFO </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> LIKE </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ADVICE </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> WARNING </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET mode </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ON </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> OFF</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET whitelist_path </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">path1, path2, </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">., pathn </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     SET blacklist_path </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">path1, path2, </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">., pathn </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The default severity is <code>WARNING</code> and the default mode is <code>ON</code>, so these are
optional. If the check is <code>OFF</code> it will only be available in debug mode (flags
<code>--debug</code> or <code>--linters-developer-mode</code>). <code>INFOs</code> are generally also not
reported, except with some specialzed flags. <code>name</code> and <code>doc_url</code> are used only
for CI comments at the moment (in Phabricator).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-paths"></a>Defining Paths<a class="hash-link" href="#defining-paths" title="Direct link to heading">#</a></h2><p><code>whitelist_path</code> and <code>blacklist_path</code> are optional, by default the rule is
enabled everywhere. For specifying paths, one can use either string constants
(<code>&quot;File.m&quot;</code>) or regexes (<code>REGEXP(&quot;path/to/.*&quot;)</code>) or variables. The variables
stand for a list of paths, and are defined in a separate block:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> GLOBAL-PATHS </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     path1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A.m&quot;</span><span class="token plain">, REGEXP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;path/to/.*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defining-macros"></a>Defining Macros<a class="hash-link" href="#defining-macros" title="Direct link to heading">#</a></h2><p>It is possible to define macros that can be used in several checkers. This is
done in the following way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GLOBAL-MACROS </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LET is_subclass_of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        is_class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> HOLDS-IN-SOME-SUPERCLASS-OF ObjCInterfaceDecl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>GLOBAL-MACROS</code> is the section of an AL specification where one can define a
list of global macros. In the example we are defining the macro <code>is_subclass(x)</code>
which can now be used in checkers instead of its complex definition.</p><p>It is possible to import a library of macros and paths with the following
command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#IMPORT &lt;library.al&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In an AL file, the command above import and make available all the macros and
paths defined in the <code>library.al</code> file.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="al-predicates"></a>AL Predicates<a class="hash-link" href="#al-predicates" title="Direct link to heading">#</a></h2><p>The simplest formulas we can write are predicates. They are defined inside
Infer. We provide a
<a href="https://github.com/facebook/infer/blob/master/infer/src/clang/cPredicates.mli" target="_blank" rel="noopener noreferrer">library</a>,
but if the predicate that you require is not available, you will need to extend
the library. Here are the some of the currently defined predicates:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_class_method (&quot;class_name&quot;, &quot;method_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_function (&quot;method_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_instance_method (&quot;class_name&quot;, &quot;method_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">call_method (&quot;method_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">captures_cxx_references ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">context_in_synchronized_block ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declaration_has_name (&quot;decl_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">declaration_ref_name (&quot;decl_ref_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">decl_unavailable_in_supported_ios_sdk ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">has_cast_kind(&quot;cast_kind&quot;) // useful in a cast node</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">has_type (&quot;type&quot;) // only builtin types, pointers and Objective-C classes available at the moment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">isa (&quot;class_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_assign_property ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_binop_with_kind (&quot;kind&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_class (&quot;class_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_const_var ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_global_var ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_ivar_atomic ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_method_property_accessor_of_ivar ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_node (&quot;node_name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_constructor ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_dealloc ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_extension ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_objc_interface_named (&quot;name&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_property_pointer_type ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_strong_property ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_weak_property ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">is_unop_with_kind (&quot;kind&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">method_return_type (&quot;type&quot;) // only builtin type, pointers, and Objective-C classes available at the moment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">objc_method_has_nth_parameter_of_type(&quot;type&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using_namespace(&quot;namespace&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">within_responds_to_selector_block ()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In general, the parameters of predicates can be constants, or variables, or
regular expressions. Variables are used in macros, see below. The syntax for
using regexes is <code>REGEX(&quot;your_reg_exp_here&quot;)</code>.</p><p><strong>NOTE:</strong> The predicates that expect types, such as <code>has_type</code> or
<code>method_return_type</code> or <code>objc_method_has_nth_parameter_of_type</code> also accept
regexes, but the syntax is a bit different: <code>REGEX(&#x27;your_reg_exp_here&#x27;)</code>, and
this regex can be embedded inside another string, for example:
<code>has_type(&quot;REGEXP(&#x27;NS.+&#x27;)*&quot; )</code> which stands for pointer to a class of name
starting with NS.</p><p>If you need to add a new predicate, write the predicate in
<a href="https://github.com/facebook/infer/blob/master/infer/src/clang/cPredicates.ml" target="_blank" rel="noopener noreferrer">cPredicates.ml</a>
and then register it in
<a href="https://github.com/facebook/infer/blob/master/infer/src/clang/cTL.ml#L728" target="_blank" rel="noopener noreferrer">CTL.ml</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="al-formulas"></a>AL Formulas<a class="hash-link" href="#al-formulas" title="Direct link to heading">#</a></h2><p>Formulas are defined using a variation of the
<a href="https://en.wikipedia.org/wiki/Computation_tree_logic" target="_blank" rel="noopener noreferrer"><em>CTL temporal logic</em></a>.
CTL is a logic expressing properties of a tree model. In the case of AL, the
tree is the AST of the program. Formulas are defined according to the following
grammar:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">formula ::= predicate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | NOT formula</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 OR formula2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 AND formula2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 IMPLIES formula2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 HOLDS-UNTIL formula2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula1 HOLDS-EVERYWHERE-UNTIL formula2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVENTUALLY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-EVENTUALLY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-NEXT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-NEXT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-ALWAYS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | formula HOLDS-EVERYWHERE-ALWAYS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | WHEN formula HOLDS-IN-NODE node-name-list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | IN-NODE node-name-list WITH-TRANSITION transition-name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               formula HOLDS-EVENTUALLY</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The first four cases (<code>NOT</code>, <code>OR</code>, <code>AND</code>, <code>IMPLIES</code>) are classic boolean
operators with the usual semantics. The others are temporal operators describing
how the truth-value of a formula is evaluated in a tree. Let&#x27;s consider case by
case.</p><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F1 <em>HOLDS-UNTIL</em> F2</td><td align="center">from the current node, there exists a path where F1 holds at every node until F2 becomes true</td></tr></tbody></table><p>An example is depicted in the following tree. When <code>F1</code> or <code>F2</code> hold in a node
this is indicated between square brackets. The formula <code>F1 HOLDS-UNTIL F2</code> holds
in the green nodes.</p><p><img src="/assets/images/holds_until-10287d3e5ce0372eb795ba68b526d5dd.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F <em>HOLDS-EVENTUALLY</em></td><td align="center">from the current node there exists a path where at some point F becomes true</td></tr></tbody></table><p>In the picture below, as <code>F</code> holds in <code>n10</code>, then <code>F HOLDS-EVENTUALLY</code> holds in
the green nodes <code>n1</code>, <code>n7</code>, <code>n10</code>. This is because from these nodes there is a
path reaching <code>n10</code> where <code>F</code> holds. Note that it holds for <code>n10</code> as well
because there exists a trivial path of length 0 from <code>n1</code> to itself.</p><p><img src="/assets/images/holds_eventually-c902ab130f9df49b713a915c9241065d.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-EVENTUALLY</td><td align="center">in every path starting from the current node at some point F becomes true</td></tr></tbody></table><p>For example, in the tree below, the formula holds in every green node because
every paths starting from each of them eventually reaches a node where F holds.</p><p><img src="/assets/images/holds_everywhere_eventually-8cf1391d0166252988f7e31d473ee1d5.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-NEXT</td><td align="center">from the current node (we are visiting) there exists a child where F is true</td></tr></tbody></table><p>In the tree below, the formula <code>F HOLDS-NEXT</code> it is true only in n1 as it&#x27;s the
only node with a child where <code>F</code> holds (node n3). In AL, <code>NEXT</code> is synonym of
child as, in terms of a path in the tree, a child is the next node.</p><p><img src="/assets/images/holds_next-e27db6b814684984c47ff598d0eef14d.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-NEXT</td><td align="center">from the current node in every existing child F is true</td></tr></tbody></table><p>In the tree below, the formula <code>F HOLDS-EVERYWHERE-NEXT</code> it is true in n1 as
it&#x27;s the only node for which in every child <code>F</code> holds (node n2, n3, and n7).</p><p><img src="/assets/images/holds_everywhere_next-eb3053c9e0b71452bc233680ed445789.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-ALWAYS</td><td align="center">from the current node there exists a path where F holds at every node</td></tr></tbody></table><p>In the tree below <code>F HOLDS-ALWAYS</code> holds in <code>n1</code>, <code>n2</code>, <code>n8</code> because for each of
these nodes there exists a path where <code>F</code> holds at each node in the path.</p><p><img src="/assets/images/always_holds-0a66ba01c776ba452279cb7fd425932b.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>F HOLDS-EVERYWHERE-ALWAYS</td><td align="center">from the current node, in every path F holds at every node</td></tr></tbody></table><p><code>F HOLDS-EVERYWHERE-ALWAYS</code> holds in <code>n2</code>, <code>n4</code>, <code>n5</code>, and <code>n8</code> because when we
visit those nodes in every path that start from them <code>F</code> holds in every node.</p><p><img src="/assets/images/always_holds_everywhere-2126ca88fa7644f4666d56ffa83235b6.jpeg"></p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>WHEN F HOLDS-IN-NODE node1,…,nodeK</td><td align="center">we are in a node among node1,…,nodeK and F holds</td></tr></tbody></table><p><code>WHEN F HOLDS-IN-NODE</code> <code>n2</code>, <code>n7</code>, <code>n6</code> holds only in node <code>n2</code> as it is the
only node in the list <code>n2</code>, <code>n7</code>, <code>n6</code> where F holds.</p><p><img src="/assets/images/holds_in_node-8f5a6d826e8db658f196302bafedb2dd.jpeg"></p><p>Let&#x27;s consider an example of checker using formula
<code>WHEN F HOLDS-IN-NODE node1,…,nodeK</code> for checking that a property with pointer
type should not be declared <em>&quot;assign&quot;</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER ASSIGN_POINTER_WARNING = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          WHEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            is_assign_property() AND is_property_pointer_type()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          HOLDS-IN-NODE ObjCPropertyDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SET message = &quot;Property `%decl_name%` is a pointer type marked with the `assign` attribute&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SET suggestion = &quot;Use a different attribute like `strong` or `weak`.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SET severity = &quot;WARNING&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The checker uses two predefined predicates <code>is_assign_property()</code> and
<code>is_property_pointer_type()</code> which are true if the property being declared is
assign and has a pointer type respectively. We want to check both conditions
only on nodes declaring properties, i.e., <code>ObjCPropertyDecl</code>.</p><hr><table><thead><tr><th>Formula</th><th align="center">Semantic meaning</th></tr></thead><tbody><tr><td>IN-NODE node1,…, nodeK WITH-TRANSITION t F HOLDS-EVENTUALLY</td><td align="center">from the current node there exists a path which eventually reaches a node among “node1,…,nodeK” with a transition t reaching a child where F holds</td></tr></tbody></table><p>The following tree explain the concept:</p><p><img src="/assets/images/in_node_with_transition-43ca9dcc9203401a9e8c1f7b938d0e59.jpeg"></p><p>The concept of transition is needed because of the special structure of the
clang AST. Certain kind of nodes, for example statements, have a list of
children that are statements as well. In this case there is no special tag
attached to the edge between the node and the children. Other nodes have
records, where some of the fields point to other nodes. For example a node
representing a function declaration will have a record where one of the fields
is body. This is pointing to a statement representing the function&#x27;s body. For
records, sometimes we need to specify that we need a particular node reachable
via a particular field (i.e., a transition).</p><p><strong>Hint</strong> A good way to learn how to write checkers is looking at existing
checkers in the file
<a href="https://github.com/facebook/infer/blob/master/infer/lib/linter_rules/linters.al" target="_blank" rel="noopener noreferrer">linters.al</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example-checks"></a>Example checks<a class="hash-link" href="#example-checks" title="Direct link to heading">#</a></h2><p>In the following we show a few examples of simple checks you may wish to write
and the corresponding formulas:</p><ul><li>A check for flagging a Objective-C class that inherits from a class that
shouldn&#x27;t be subclassed.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER SUBCLASSING_TEST_EXAMPLE = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   SET report_when = is_class(&quot;A&quot;) HOLDS-IN-SOME-SUPERCLASS-OF ObjCInterfaceDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   SET message = &quot;This is subclassing A. Class A should not be subclassed.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging an Objective-C instance method call:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_INSTANCE_METHOD = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_instance_method(&quot;A&quot;, &quot;foo:&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call this method&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging an Objective-C instance method call of any method of a
class:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_ANY_INSTANCE_METHODS = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_instance_method(A, REGEXP(&quot;*&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call any method of class A&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging an Objective-C class method call:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER CALL_CLASS_METHOD = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = call_class_method(&quot;A&quot;, &quot;foo:&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not call this method&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging an Objective-C method call of a method with int return
type:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_RETURN_METHOD = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = WHEN method_return_type(&quot;int&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Method return int&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a variable declaration with type long</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_VAR_TYPE_CHECK = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = WHEN has_type(&quot;long&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE VarDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Var %name% has type long&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a method that has a parameter of type A*</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PARAM_TYPE_CHECK = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_a_parameter_with_type(x) =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN HOLDS-NEXT WITH-TRANSITION Parameters (has_type(x))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           method_has_a_parameter_with_type(&quot;A*&quot; );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Found a method with a parameter of type A&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a method that has all the parameters of type A* (and at
least one)</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PARAM_TYPE_CHECK2 = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_at_least_a_parameter =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN HOLDS-NEXT WITH-TRANSITION Parameters (TRUE)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   LET method_has_all_parameter_with_type(x) =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN HOLDS-EVERYWHERE-NEXT WITH-TRANSITION Parameters (has_type(x))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = method_has_at_least_a_parameter AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    method_has_all_parameter_with_type(&quot;int&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;All the parameters of the method have type int&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a method that has the 2nd parameter of type A*</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_NTH_PARAM_TYPE_CHECK = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    WHEN objc_method_has_nth_parameter_of_type(&quot;2&quot;, &quot;A*&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Found a method with the 2nd parameter of type A*&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET severity = &quot;LIKE&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a protocol that inherits from a given protocol.
<code>HOLDS-EVENTUALLY WITH-TRANSITION Protocol</code> means follow the <code>Protocol</code> branch
in the AST until the condition holds.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PROTOCOL_DEF_INHERITANCE = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LET is_subprotocol_of(x) = declaration_has_name(x) HOLDS-EVENTUALLY WITH-TRANSITION Protocol;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    WHEN is_subprotocol_of(&quot;P&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HOLDS-IN-NODE ObjCProtocolDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not inherit from Protocol P&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging when a constructor is defined with a parameter of a type
that implements a given protocol (or that inherits from it).
<code>HOLDS-NEXT WITH-TRANSITION Parameters</code> means, starting in the
<code>ObjCMethodDecl</code> node, follow the <code>Parameters</code> branch in the AST and check
that the condition holds there.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_PROTOCOL_TYPE_INHERITANCE = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LET method_has_parameter_subprotocol_of(x) =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            WHEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             HOLDS-NEXT WITH-TRANSITION Parameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                (has_type_subprotocol_of(x))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        declaration_has_name(REGEXP(&quot;^newWith.*:$&quot;)) AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        method_has_parameter_subprotocol_of(&quot;P&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      HOLDS-IN-NODE ObjCMethodDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not define parameters of type P.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging a variable declaration of type NSArray applied to A.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_GENERICS_TYPE = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      WHEN has_type(&quot;NSArray&lt;A&gt;*&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      HOLDS-IN-NODE VarDecl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not create arrays of type A&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging using a property or variable that is not available in the
supported API. decl_unavailable_in_supported_ios_sdk is a predicate that works
on a declaration, checks the available attribute from the declaration and
compares it with the supported iOS SDK. Notice that we flag the occurrence of
the variable or property, but the attribute is in the declaration, so we need
the transition <code>PointerToDecl</code> that follows the pointer from the usage to the
declaration.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER UNAVAILABLE_API_IN_SUPPORTED_IOS_SDK = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    WHEN HOLDS-NEXT WITH-TRANSITION PointerToDecl</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     (decl_unavailable_in_supported_ios_sdk() AND</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    HOLDS-IN-NODE DeclRefExpr;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;%name% is not available in the required iOS SDK version&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging using a given namespace</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER TEST_USING_NAMESPACE = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = using_namespace(&quot;N&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not use namespace N&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>A check for flagging the use of given enum constants</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINE-CHECKER ENUM_CONSTANTS = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET report_when = is_enum_constant(REGEXP(&quot;MyName.*&quot;));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SET message = &quot;Do not use the enum MyName&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ast-info-in-messages"></a>AST info in messages<a class="hash-link" href="#ast-info-in-messages" title="Direct link to heading">#</a></h2><p>When you write the message of your rule, you may want to specify which
particular AST items were involved in the issue, such as a type or a variable
name. We have a mechanism for that, we specified a few placeholders that can be
used in rules with the syntax <code>%placeholder%</code> and it will be substituted by the
correct AST info. At the moment we have <code>%type%</code>, <code>%child_type%</code> and <code>%name%</code>
that print the type of the node, the type of the node&#x27;s child, and a string
representation of the node, respectively. As with predicates, we can add more as
needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing-your-rule"></a>Testing your rule<a class="hash-link" href="#testing-your-rule" title="Direct link to heading">#</a></h2><p>To test your rule you need to run it with Infer. If you are adding a new linter
you can test it in a separate al file that you can pass to Infer with the option
<code>--linters-def-file file.al</code>. Pass the option
<code>--linters-developer-mode --linter &lt;LINTER_NAME&gt;</code> to Infer to print debug
information and only run the linter you are developing, so it will be faster and
the debug info will be only about your linter.</p><p>To test your code, write a small example that triggers the rule. Then, run your
code with</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">infer --linters-developer-mode --linters-def-file file.al -- clang -c Test.m</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>the bug should be printed in the screen, like, for instance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">infer/tests/codetoanalyze/objcpp/linters/global-var/B.mm:34: warning: GLOBAL_VARIABLE_INITIALIZED_WITH_FUNCTION_OR_METHOD_CALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Global variable kLineSize is initialized using a function or method call at line 34, column 1. If the function/method call is expensive,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  it can affect the starting time of the app.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  32.   static float kPadding = [A bar] ? 10.0 : 11.0; // Error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  33.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  34. &gt; static const float kLineSize = 1 / [A scale]; // Error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  35.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  36.   static const float ok = 37;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  37.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Moreover, the bug can be found in the file <code>infer-out/report.json</code> where
<code>infer-out</code> is the results directory where Infer operates, that is created in
the current directory. You can specify a different directory with the option
<code>-o</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="debugging"></a>Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">#</a></h2><p>If there are syntax errors or other parsing errors with your al file, you will
get an error message when testing the rule, remember to use
<code>linters-developer-mode</code> when you are developing a rule. If the rule gets parsed
but still doesn&#x27;t behave as you expect, you can debug it, by adding the
following line to a test source file in the line where you want to debug the
rule: <code>//INFER_BREAKPOINT</code>. Then run infer again in linters developer mode, and
it will stop the execution of the linter on the line of the breakpoint. Then you
can follow the execution step by step. It shows the current formula that is
being evaluated, and the current part of the AST that is being checked. A red
node means that the formula failed, a green node means that it succeeded.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="demo"></a>Demo<a class="hash-link" href="#demo" title="Direct link to heading">#</a></h2><iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Finferstaticanalyzer%2Fvideos%2F810308939133850%2F&amp;show_text=0&amp;width=400" width="500" height="500" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen=""></iframe><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="command-line-options-for-linters"></a>Command line options for linters<a class="hash-link" href="#command-line-options-for-linters" title="Direct link to heading">#</a></h2><p>The linters are run by default when you run Infer. However, there is a way of
running only the linters, which is faster than also running Infer. This is by
adding the option <code>--linters</code> to the analysis command as in this example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">infer run --linters -- clang -c Test.m</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>There are a few other command-line options that are useful for using or
developing new linters in Infer. Read about them in the <a href="/docs/1.0.0/man-infer-capture"><code>infer capture</code> manual</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="list-of-issue-types"></a>List of Issue Types<a class="hash-link" href="#list-of-issue-types" title="Direct link to heading">#</a></h2><p>The following issue types are reported by this checker:</p><ul><li><a href="/docs/1.0.0/all-issue-types#assign_pointer_warning">ASSIGN_POINTER_WARNING</a></li><li><a href="/docs/1.0.0/all-issue-types#bad_pointer_comparison">BAD_POINTER_COMPARISON</a></li><li><a href="/docs/1.0.0/all-issue-types#component_with_multiple_factory_methods">COMPONENT_WITH_MULTIPLE_FACTORY_METHODS</a></li><li><a href="/docs/1.0.0/all-issue-types#cxx_reference_captured_in_objc_block">CXX_REFERENCE_CAPTURED_IN_OBJC_BLOCK</a></li><li><a href="/docs/1.0.0/all-issue-types#direct_atomic_property_access">DIRECT_ATOMIC_PROPERTY_ACCESS</a></li><li><a href="/docs/1.0.0/all-issue-types#discouraged_weak_property_custom_setter">DISCOURAGED_WEAK_PROPERTY_CUSTOM_SETTER</a></li><li><a href="/docs/1.0.0/all-issue-types#global_variable_initialized_with_function_or_method_call">GLOBAL_VARIABLE_INITIALIZED_WITH_FUNCTION_OR_METHOD_CALL</a></li><li><a href="/docs/1.0.0/all-issue-types#mutable_local_variable_in_component_file">MUTABLE_LOCAL_VARIABLE_IN_COMPONENT_FILE</a></li><li><a href="/docs/1.0.0/all-issue-types#pointer_to_const_objc_class">POINTER_TO_CONST_OBJC_CLASS</a></li><li><a href="/docs/1.0.0/all-issue-types#strong_delegate_warning">STRONG_DELEGATE_WARNING</a></li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/1.0.0/checker-inefficient-keyset-iterator"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Inefficient keySet Iterator</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/1.0.0/checker-litho-required-props"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Litho &quot;Required Props&quot; »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#al-a-declarative-language-for-writing-linters-in-infer" class="table-of-contents__link">AL: A declarative language for writing linters in Infer</a></li><li><a href="#getting-the-clang-ast" class="table-of-contents__link">Getting the clang AST</a></li><li><a href="#using-al-to-write-linters" class="table-of-contents__link">Using AL to write linters</a></li><li><a href="#defining-paths" class="table-of-contents__link">Defining Paths</a></li><li><a href="#defining-macros" class="table-of-contents__link">Defining Macros</a></li><li><a href="#al-predicates" class="table-of-contents__link">AL Predicates</a></li><li><a href="#al-formulas" class="table-of-contents__link">AL Formulas</a></li><li><a href="#example-checks" class="table-of-contents__link">Example checks</a></li><li><a href="#ast-info-in-messages" class="table-of-contents__link">AST info in messages</a></li><li><a href="#testing-your-rule" class="table-of-contents__link">Testing your rule</a></li><li><a href="#debugging" class="table-of-contents__link">Debugging</a></li><li><a href="#demo" class="table-of-contents__link">Demo</a></li><li><a href="#command-line-options-for-linters" class="table-of-contents__link">Command line options for linters</a></li><li><a href="#list-of-issue-types" class="table-of-contents__link">List of Issue Types</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/infer-workflow">User Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/about-Infer">Foundations</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/all-issue-types">Bug Types Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/absint-framework">Contribute</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/infer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/fbinfer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.facebook.com/inferstaticanalyzer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.7a3bfc13.js"></script>
<script src="/assets/js/runtime~main.f45cfbc3.js"></script>
<script src="/assets/js/main.4397eb74.js"></script>
<script src="/assets/js/1.b5bf5a34.js"></script>
<script src="/assets/js/2.87dfd38b.js"></script>
<script src="/assets/js/3.529b6fba.js"></script>
<script src="/assets/js/1be78505.c4007472.js"></script>
<script src="/assets/js/183.7a16840f.js"></script>
<script src="/assets/js/62e81aa6.e2500d24.js"></script>
<script src="/assets/js/17896441.1b2449d5.js"></script>
<script src="/assets/js/e2e89445.5243bdc8.js"></script>
</body>
</html>